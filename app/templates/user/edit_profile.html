{% extends '../page_base.html' %}
{% load static %}

{% block title %}Edit Profile - The Sync Point{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/user/edit_profile.css' %}">
{% endblock %}

{% block main %}
<div class="edit-profile-container">
    <!-- Header -->
    <div class="edit-profile-header">
        <h1>Edit Your Profile</h1>
        <p>Update your personal information and preferences</p>
    </div>

    <!-- Edit Profile Card -->
    <div class="edit-profile-card">
        <form method="POST" action="{% url 'edit_profile' %}" class="edit-profile-form" enctype="multipart/form-data" id="editProfileForm">
            {% csrf_token %}

            <!-- Profile Picture -->
            <div class="profile-picture-section">
                <div class="current-avatar">
                    {% if user.profile_picture %}
                    <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}">
                    {% else %}
                    <img src="{% static 'images/default-profile.jpg' %}" alt="Default Profile">
                    {% endif %}
                </div>
                <div class="avatar-actions">
                    <label>Profile Picture</label>
                    <div class="file-input" onclick="document.getElementById('profile_picture').click()">
                        <input type="file" 
                            id="profile_picture" 
                            name="profile_picture" 
                            accept="image/*" 
                            onchange="previewImage(this)"
                            style="display: none;">
                        <i class="fas fa-camera" style="font-size: 24px; color: #ff7e5f; margin-bottom: 8px; display: block;"></i>
                        <p>Click to upload a new profile picture</p>
                        <p style="color: #999; margin-top: 5px; font-size: 0.8rem;">Max 5MB</p>
                    </div>
                    <div class="form-help" id="file-name-display" style="margin-top: 10px;"></div>
                </div>
            </div>
            
            <!-- Username -->
            <div class="form-group">
                <label for="username">Username <span class="required">*</span></label>
                <div class="input-with-icon">
                    <i class="fas fa-user input-icon"></i>
                    <input type="text" 
                           id="username" 
                           name="username" 
                           value="{{ user.username }}"
                           required
                           placeholder="Enter your username">
                </div>
                <div class="form-help">This is how you'll appear on the site</div>
            </div>

            <!-- Name Fields -->
            <div class="form-row">
                <div class="form-group">
                    <label for="first_name">First Name</label>
                    <div class="input-with-icon">
                        <i class="fas fa-signature input-icon"></i>
                        <input type="text" 
                               id="first_name" 
                               name="first_name" 
                               value="{{ user.first_name|default:'' }}"
                               placeholder="Enter your first name">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="last_name">Last Name</label>
                    <div class="input-with-icon">
                        <i class="fas fa-signature input-icon"></i>
                        <input type="text" 
                               id="last_name" 
                               name="last_name" 
                               value="{{ user.last_name|default:'' }}"
                               placeholder="Enter your last name">
                    </div>
                </div>
            </div>

            <!-- Email -->
            <div class="form-group">
                <label for="email">Email Address <span class="required">*</span></label>
                <div class="input-with-icon">
                    <i class="fas fa-envelope input-icon"></i>
                    <input type="email" 
                           id="email" 
                           name="email" 
                           value="{{ user.email }}"
                           required
                           placeholder="Enter your email address">
                </div>
                <div class="form-help">We'll never share your email with anyone else</div>
            </div>

            <!-- Phone Number -->
            <div class="form-group">
                <label for="phone_number">Phone Number</label>
                <div class="input-with-icon">
                    <i class="fas fa-phone input-icon"></i>
                    <input type="text" 
                           id="phone_number" 
                           name="phone_number" 
                           value="{{ user.phone_number|default:'' }}"
                           placeholder="Enter your phone number">
                </div>
                <div class="form-help">Optional - for account recovery purposes</div>
            </div>

            <!-- Bio -->
            <div class="form-group">
                <label for="bio">Bio</label>
                <textarea id="bio" 
                          name="bio" 
                          placeholder="Tell us a little about yourself..."
                          maxlength="500">{{ user.bio|default:'' }}</textarea>
                <div class="form-help">
                    <span id="bio-counter">{{ user.bio|length|default:0 }}</span>/500 characters
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="submit-btn" onclick="showSaveCard()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
                <a href="{% url 'profile' %}" class="cancel-btn">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Image Size Alert Card -->
<div id="imageSizeAlert" class="image-alert-card" style="display: none;">
    <div class="alert-card-content">
        <div class="alert-icon">
            <i class="fas fa-exclamation-circle"></i>
        </div>
        <h3 class="alert-title">Image Too Large</h3>
        <p class="alert-message" id="imageAlertMessage">
            The image you uploaded exceeds the <strong>5MB size limit</strong>. 
            Please optimize your image or choose a smaller file.
        </p>
        <div class="alert-suggestions">
            <h4>Quick Tips:</h4>
            <ul>
                <li><i class="fas fa-check"></i> Use image compression tools like TinyPNG</li>
                <li><i class="fas fa-check"></i> Resize to 500x500px recommended dimensions</li>
                <li><i class="fas fa-check"></i> Convert to JPEG for smaller file size</li>
                <li><i class="fas fa-check"></i> Square images work best for profile pictures</li>
            </ul>
        </div>
        <button class="got-it-btn" onclick="hideImageAlert()">
            <i class="fas fa-thumbs-up"></i> Got It
        </button>
    </div>
</div>

<!-- Save Changes Confirmation Card -->
<div id="saveConfirmCard" class="save-confirm-card" style="display: none;">
    <div class="save-card-content">
        <div class="save-icon">
            <i class="fas fa-user-edit"></i>
        </div>
        <h3 class="save-title">Save Profile Changes?</h3>
        <p class="save-message" id="saveProfileMessage">
            Are you sure you want to save the changes to your profile?
        </p>
        <div class="save-info">
            <div class="info-row">
                <i class="fas fa-check-circle"></i>
                <span>Your profile information will be updated</span>
            </div>
            <div class="info-row">
                <i class="fas fa-image"></i>
                <span>Profile picture will be updated if changed</span>
            </div>
            <div class="info-row">
                <i class="fas fa-globe"></i>
                <span>Changes will be visible to everyone</span>
            </div>
            <div class="info-row warning-row">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Make sure all information is correct</span>
            </div>
        </div>
        
        <div class="save-actions">
            <button type="button" class="cancel-save-btn" onclick="hideSaveCard()">
                <i class="fas fa-times"></i> Continue Editing
            </button>
            <button type="button" class="confirm-save-btn" onclick="submitForm()">
                <i class="fas fa-save"></i> Yes, Save Changes
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/edit_profile.js' %}"></script>
{% endblock %}