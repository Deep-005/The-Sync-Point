{% extends '../blog_base.html' %}
{% load static %}

{% block blog_title %}Preview Blog - {{ blog.title }}{% endblock %}
{% block page_heading %}Preview Blog{% endblock %}
{% block page_subtitle %}Review your blog before publishing{% endblock %}

{% block blog_css %}
<link rel="stylesheet" href="{% static 'css/blog/preview_blog.css' %}">
{% endblock %}

{% block blog_content %}
<!-- Status Badge -->
<div class="status-indicator">
    <span class="status-badge status-{{ blog.status }}">
        <i class="fas 
            {% if blog.status == 'published' %}fa-globe
            {% elif blog.status == 'draft' %}fa-edit
            {% else %}fa-archive
            {% endif %}"></i>
        {{ blog.get_status_display }}
    </span>
</div>

<!-- Action Buttons -->
<div class="preview-actions">
    {% if blog.status == 'draft' or blog.status == 'archived' %}
    <button type="button" class="publish-bottom-btn" 
            onclick="showPublishCard('{{ blog.id }}', '{{ blog.title|escapejs }}')">
        <i class="fas fa-paper-plane"></i> 
        {% if blog.status == 'archived' %}Republish Blog{% else %}Publish Blog{% endif %}
    </button>
    {% endif %}
    
    <a href="{% url 'edit_blog' blog.id %}" class="edit-action-btn">
        <i class="fas fa-edit"></i> Edit Blog
    </a>
    
    <a href="{% url 'profile' %}" class="back-action-btn">
        <i class="fas fa-arrow-left"></i> Back to Profile
    </a>
</div>

<!-- Blog Preview Card -->
<div class="blog-preview-card">
    <!-- Blog Header -->
    <div class="blog-preview-header">
        <!-- Category Badge -->
        <span class="preview-category">
            <i class="fas fa-tag"></i> {{ blog.get_content_type_display }}
        </span>
        
        <!-- Title -->
        <h1 class="preview-title">{{ blog.title }}</h1>
        
        <!-- Author and Date -->
        <div class="preview-meta">
            <div class="author-info">
                {% if blog.author.profile_picture %}
                <img src="{{ blog.author.profile_picture.url }}" alt="{{ blog.author.username }}" class="author-avatar">
                {% else %}
                <img src="{% static 'images/default-profile.jpg' %}" alt="Default" class="author-avatar">
                {% endif %}
                <div class="author-details">
                    <span class="author-name">{{ blog.author.get_full_name|default:blog.author.username }}</span>
                    <span class="publish-date">
                        <i class="fas fa-calendar"></i>
                        {% if blog.status == 'published' %}
                            Published: {{ blog.created_at|date:"F d, Y" }}
                        {% else %}
                            Created: {{ blog.created_at|date:"F d, Y" }}
                        {% endif %}
                    </span>
                </div>
            </div>
            
            <!-- Reading Time -->
            <div class="reading-time">
                <i class="fas fa-clock"></i>
                {% with word_count=blog.content|wordcount %}
                {% with reading_time=word_count|divisibleby:"200"|add:word_count|add:199|floatformat:0 %}
                {{ reading_time }} min read
                {% endwith %}
                {% endwith %}
            </div>
        </div>
    </div>

    <!-- Featured Image -->
    {% if blog.image %}
    <div class="preview-featured-image">
        <img src="{{ blog.image.url }}" alt="{{ blog.title }}">
    </div>
    {% endif %}

    <!-- Blog Content -->
    <div class="preview-content">
        {{ blog.content|linebreaks|safe }}
    </div>

    <!-- Blog Footer -->
    <div class="preview-footer">
        <!-- Stats (if published) -->
        {% if blog.status == 'published' %}
        <div class="preview-stats">
            <div class="stat-item">
                <i class="fas fa-eye"></i>
                <span>{{ blog.views_formatted }} views</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-thumbs-up"></i>
                <span>{{ blog.likes_formatted }} likes</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-thumbs-down"></i>
                <span>{{ blog.dislikes_formatted }} dislikes</span>
            </div>
        </div>
        {% endif %}
        
        <!-- Last Updated -->
        <div class="last-updated">
            <i class="fas fa-history"></i>
            Last updated: {{ blog.updated_at|date:"F d, Y \a\t g:i A" }}
        </div>
    </div>
</div>

<!-- Bottom Actions -->
<div class="bottom-actions">
    <div class="action-group">
        {% if blog.status == 'draft' or blog.status == 'archived' %}
        <button type="button" class="publish-bottom-btn" 
                onclick="showPublishCard('{{ blog.id }}', '{{ blog.title|escapejs }}')">
            <i class="fas fa-paper-plane"></i> 
            {% if blog.status == 'archived' %}Republish Now{% else %}Publish Now{% endif %}
        </button>
        {% endif %}
    </div>
    
    <div class="action-group">
        <button type="button" class="delete-bottom-btn" 
                onclick="showDeleteCard('{{ blog.id }}', '{{ blog.title|escapejs }}')">
            <i class="fas fa-trash"></i> Delete
        </button>
    </div>
</div>

<!-- Delete Confirmation Card -->
<div id="deleteConfirmCard" class="confirm-card" style="display: none;">
    <div class="delete-card-content">
        <div class="delete-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3 class="delete-title">Delete Blog Post?</h3>
        <p class="delete-message" id="deleteBlogTitle">
            Are you sure you want to delete "<strong>Blog Title Here</strong>"?
        </p>
        <div class="delete-warning">
            <i class="fas fa-exclamation-circle"></i>
            <p>This action <strong>cannot be undone</strong>. The blog post and all its data (likes, comments, views) will be permanently removed.</p>
        </div>
        
        <!-- Hidden form to submit delete request -->
        <form id="deleteBlogForm" method="POST" action="">
            {% csrf_token %}
            <div class="delete-actions">
                <button type="button" class="cancel-delete-btn" onclick="hideDeleteCard()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="submit" class="confirm-delete-btn">
                    <i class="fas fa-trash"></i> Yes, Delete
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Publish Confirmation Card -->
<div id="publishConfirmCard" class="confirm-card" style="display: none;">
    <div class="publish-card-content">
        <div class="publish-icon">
            <i class="fas fa-paper-plane"></i>
        </div>
        <h3 class="publish-title">Publish Blog Post?</h3>
        <p class="publish-message" id="publishBlogTitle">
            Are you ready to publish "<strong>Blog Title Here</strong>" to the world?
        </p>
        <div class="publish-info">
            <div class="info-row">
                <i class="fas fa-globe"></i>
                <span>Your blog will be visible to everyone</span>
            </div>
            <div class="info-row">
                <i class="fas fa-bell"></i>
                <span>Readers can like, comment, and share</span>
            </div>
            <div class="info-row">
                <i class="fas fa-chart-line"></i>
                <span>Views and engagement stats will start tracking</span>
            </div>
            <div class="info-row">
                <i class="fas fa-edit"></i>
                <span>You can still edit after publishing</span>
            </div>
        </div>
        
        <!-- Hidden form to submit publish request -->
        <form id="publishBlogForm" method="POST" action="">
            {% csrf_token %}
            <div class="publish-actions">
                <button type="button" class="cancel-publish-btn" onclick="hidePublishCard()">
                    <i class="fas fa-times"></i> Not Yet
                </button>
                <button type="submit" class="confirm-publish-btn">
                    <i class="fas fa-paper-plane"></i> Yes, Publish Now
                </button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block blog_js %}
<script src="{% static 'js/preview_blog.js' %}"></script>
{% endblock %}