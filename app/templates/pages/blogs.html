{% extends '../page_base.html' %}
{% load static %}

{% block title %}Blogs - The Sync Point{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/blogs.css' %}">
{% endblock %}

{% block main %}
<main style="height: auto;">

    <!-- Hero Section -->
    <section class="blogs-hero">
        <div class="blog-hero-container">
            <h1>Explore Our Blog Collection</h1>
            <p>Dive into insightful articles across all categories. From technology to lifestyle, find content that inspires and informs.</p>
            <div class="hero-search">

                <form method="GET" action="{% url 'search_results' %}" class="search-box hero-search-box">
                    {% csrf_token %}
                    <input type="search" class="search-input" name="q" placeholder="Search blog articles..." value="{{ request.GET.q|default:'' }}" required>
                    <button type="submit" class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
                <div class="btns">
                    {% if not user.is_authenticated %}
                    <a href="{% url 'signup' %}" 
                        style="text-decoration: none; 
                        display: inline-block;"
                        title="Log in to write a blog">
                            <button class="btn">
                                <i class="fa fa-user-plus"></i> Sign Up
                            </button>
                    </a>
                    {% else %}
                    <a href="{% url 'write_blog' %}" 
                        style="text-decoration: none; 
                        display: inline-block;">
                            <button class="btn">
                                <i class="fa fa-pen"></i> Write Blog
                            </button>
                    </a>
                    {% endif %}

                </div>

            </div>

        </div>
    </section>

    <!-- Blogs Section -->
    <section class="blogs-section">
        <div class="container">
            <!-- Section Header -->
            <div class="section-header">
                <h2 class="section-title">All Blogs</h2>
                <span class="header-stat-item">(
                    <span class="stat-number">{{ blogs.paginator.count }}</span>
                    <span class="stat-label">
                        article{{ blogs.paginator.count|pluralize }}
                    </span>)
                </span>
            </div>

            <!-- Selected category name -->
            <div class="selected-category-display">
                <button class="filter-title">
                    {% if selected_category %}
                        {% for cat_code, cat_name in all_categories %}
                            {% if cat_code == selected_category %}
                             Filter: {{ cat_name }}
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        All Categories
                    {% endif %}
                </button>
                {% if selected_category %}
                <a href="{% url 'blogs' %}" class="clear-filter" style="text-decoration: none; display: inline-block;">
                    <button class="clear-filter-btn"><i class="fas fa-times"></i> Clear Filter </button>
                </a>
                {% endif %}
            </div>

            <!-- Blog Grid -->
            <div class="blog-grid">
                {% for blog in blogs %}
                <article class="blog-card">
                    <!-- Category Badge -->
                    <div class="blog-category">
                        <span>Type: {{ blog.get_content_type_display }}</span>
                    </div>
                    
                    <!-- Blog Image -->
                    <div class="blog-image">
                        <img src="{% if blog.image %}{{ blog.image.url }}{% endif %}" 
                            alt="{{ blog.title }}" >
                    </div>
                    
                    <!-- Blog Content -->
                    <div class="blog-content">
                        <div class="blog-meta">
                            <span class="blog-date">{{ blog.created_at|date:"M d, Y" }}</span>
                            <span class="blog-author">by {{ blog.author }}</span>
                        </div>
                        
                        <h3 class="blog-title">
                            <a href="{% url 'blog_detail' blog.id %}">{{ blog.title }}</a>
                        </h3>
                        
                        <p class="blog-excerpt">{{ blog.content|truncatechars:120 }}</p>
                        
                        <a href="{% url 'blog_detail' blog.id %}" class="read-more">
                            Read Article
                            <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </article>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="pagination-container">
        <div class="pagination">
            <!-- Previous Button -->
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="pagination-btn prev-btn">
                <i class="fas fa-chevron-left"></i> Prev
            </a>
            {% else %}
            <span class="pagination-btn prev-btn disabled">
                <i class="fas fa-chevron-left"></i> Prev
            </span>
            {% endif %}
            
            <!-- Page Numbers -->
            <div class="page-numbers">
                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                    <span class="page-number current">{{ num }}</span>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a href="?page={{ num }}" class="page-number">{{ num }}</a>
                    {% elif num == 1 %}
                    <a href="?page={{ num }}" class="page-number">{{ num }}</a>
                    {% if page_obj.number > 4 %}
                    <span class="page-dots">...</span>
                    {% endif %}
                    {% elif num == page_obj.paginator.num_pages %}
                    {% if page_obj.number < page_obj.paginator.num_pages|add:'-3' %}
                    <span class="page-dots">...</span>
                    {% endif %}
                    <a href="?page={{ num }}" class="page-number">{{ num }}</a>
                    {% endif %}
                {% endfor %}
            </div>
            
            <!-- Next Button -->
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="pagination-btn next-btn">
                Next <i class="fas fa-chevron-right"></i>
            </a>
            {% else %}
            <span class="pagination-btn next-btn disabled">
                Next <i class="fas fa-chevron-right"></i>
            </span>
            {% endif %}
        </div>
    </div>
    {% endif %}


</main>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/blogs.js' %}"></script>
{% endblock %}